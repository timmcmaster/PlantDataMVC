@model PlantDataMVC.Web.Models.ViewModels.Site.SiteShowViewModel
@{
    ViewBag.Title = "Show";
}
<h2>Show</h2>
<div class="container-lg">
    <fieldset>
        <legend>Site</legend>

        <input asp-for="Id" type="hidden" />

        <div class="row mb-3">
            <label asp-for="SiteName" class="col-sm-2 col-form-label"></label>
            <div class="col-sm-10">
                <p class="col-form-label">@Html.DisplayFor(model => model.SiteName)</p>
            </div>
        </div>

        <div class="row mb-3">
            <label asp-for="Suburb" class="col-sm-2 col-form-label"></label>
            <div class="col-sm-10">
                <p class="col-form-label">@Html.DisplayFor(model => model.Suburb)</p>
            </div>
        </div>

        <div class="row mb-3">
            <label asp-for="Latitude" class="col-sm-2 col-form-label"></label>
            <div class="col-sm-10">
                <p class="col-form-label">@Html.DisplayFor(model => model.Latitude)</p>
            </div>
        </div>

        <div class="row mb-3">
            <label asp-for="Longitude" class="col-sm-2 col-form-label"></label>
            <div class="col-sm-10">
                <p class="col-form-label">@Html.DisplayFor(model => model.Longitude)</p>
            </div>
        </div>

        @*<div class="child-table">@Html.Partial("SeedBatchListTable", Model.SeedBatches)</div>*@
        @*<div class="button"><a asp-controller=@PlantDataMvcAppControllers.SeedTray asp-action="New" asp-route-id=@Model.Id>New</a></div>*@
    </fieldset>

    <!-- This is the div that will contain the map -->
    <div id="map" class="map"><div id="popup"></div></div>

    <!-- Enclose the Javascript in a "section" so that it is rendered in the correct order after scripts have been loaded etc -->
    @section Scripts{
        <script type="text/javascript" src="~/js/lib/maplib.bundle.js"></script>
        <script type="text/javascript">

            // This code tells the browser to execute the "Initialize" method only when the complete document model has been loaded.
            $(document).ready(function () {
                Initialise();
            });

            function Initialise() {
                // get siteModel in JSON encoded format
                var latitude = @Html.Raw(Json.Serialize(Model.Latitude));
                var longitude = @Html.Raw(Json.Serialize(Model.Longitude));
                var siteName = @Html.Raw(Json.Serialize(Model.SiteName));
                var centreLat = latitude;
                var centreLong = longitude;
                var zoomLevel = 12;

                // TODO: Need some sort of error on invalid coordinates
                var map = maplib.createMap(document.getElementById('map'), latitude, longitude, zoomLevel);
                maplib.addMarker(map, centreLat, centreLong, siteName);
            };
        </script>
    }

    <p>
        <a asp-controller=@PlantDataMvcAppControllers.Site asp-action="Edit" asp-route-id="@Model.Id">Edit</a> |
        <a asp-controller=@PlantDataMvcAppControllers.Site asp-action="Index">Back to Index</a>
    </p>
</div>
<style>
    .map {
        height: 400px;
        width: 400px;
    }
</style>

